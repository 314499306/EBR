# 处方管理

---

## 1. 状态管理

- 1.1 处方生命周期:
  - ![处方_处方管理](/pics/配方_配方管理.png)
- 1.2 处方状态说明:
  - 可以复制任何状态的处方.
  - 失效的处方重新激活后,其状态为初始状态,即`可编辑`
  - 已经失效的处方在重新激活之前,,不允许进行编辑,不可进行激活之外的状态变更.
  - 研发处方在`批准`之前允许撤回到`可编辑`状态,临床处方在`验证`之前允许撤回到`可编辑`状态
  - 只有`可编辑`状态的处方才允许编辑,并且提交编辑结果时,验证该处方状态是否是可编辑状态
  - 研发处方只有`批准`状态才允许创建工单, 临床处方只有`验证`之后才允许创建工单,另外,超过有效期的处方是不允许创建工单的
  - 可以`失效`任何状态的处方.
  - 版本修订说明: `批准`和`验证`的处方才能升级版本
- 1.3 处方验证
  - 验证路径: ![处方_验证路径](/pics/配方_验证路径.png)

---

## 2. 处方编码生成规则

- 处方编码由系统生成,规则如下:
  1. F+6 位数字,如 F000001
  2. 新建处方时数字序列增加 1,不要求连续

---

## 3. 功能说明

- 【新建】:创建一个新处方,处方默认版本为`0`
- 【修订】:
  - 处方的版本化管理;
  - 处方编码也会被复制,且不可编辑,其他处方信息可编辑;
  - 该功能最后会新建一个编码相同,但是版本不同的处方
  - 版本升级规则:该处方编码的当前最大版本号+1
- 【复制】:快速创建处方的功能,复制除处方编码之外的信息.
- 明细查看:查看指定处方的明细信息;查看方式如下:
  - 双击指定处方, 以只读方式显示处方明细
  - 指定处方,点击【查看】按钮,以只读方式显示处方明细

---

## 4. 业务说明

### 4.1 处方管理中的数量单位:

- ![处方_数量说明](/pics/配方_数量说明.png)
- 产品单位:界面上没有显示该值;为处方指定产品后,所选产品的库存单位（物料维护中,可以设定该值）,即为该处方的产品单位;
- 处方单位(种类):
  - Q:定量处方,不需要指定处方单位
  - U:单一处方,处方单位使用`UINT_UNIT`

### 4.2 处方的两个种类

- Q:定量处方,使用的单位为质量或容量单位; 定量处方的产品是按照多少公斤,多少升来算的
- U:单一处方,可用单位:un,kn,fl; 简单来说,就是单一处方的产品,是按多少个,多少片,多少瓶来算的

### 4.3 目前的单位是存于字典表中的.

- ![处方_单一单位说明](/pics/配方_单一单位说明.png)  
  **举例如下**
- ![处方_种类说明](/pics/配方_种类说明.png)

### 4.4 参考数量单位:

- 单一处方:使用`UINT_UNIT`,**不需要**兼容产品单位,fl 单位产品,只能选择 fl 类型单位
- 定量处方:使用`EBR_UNIT`,需要兼容产品单位

### 4.5 称量当量单位:使用`MASS_UNIT`

### 4.6 阶段次序说明:

- ![处方_阶段次序说明](/pics/配方_阶段次序说明.png)

### 4.7 关于必填字段补充说明:

- 参考数量和单位,等价数量和单位不能为空.

### 4.8 有效期限制:

- 默认 20 年有效期: [创建日期,创建日期+20 年]
- 有效期的结束时间不能在开始时间之前

### 4.9 处方物料清单限制:

- 阶段次序限制,针对单个处方的物料清单:
  1.  清单中的 阶段+次序 是唯一的
  2.  每个阶段中的次序是唯一的
- 处方物料清单中的物料必须全部存在.
- 关于补偿器物料说明:
  1.  一个处方中,补偿器物料不会单独出现.如果出现补偿器物料,那么前提是一定存在一个非补偿器物料.
  2.  一个物料是否能为补偿物料,主要依据为物料基础维护中该物料效价 1 是否为 N,如果是 N,则可以作为补偿物料.
- 剂量: 目前全部默认为 1,不可编辑
