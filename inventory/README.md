# 库存管理

- 本部分用来描述 EBR 系统的库存管理,以车间库为主要服务的业务对象
- 存储实体:托盘与容器
- 用户依据自己的情况创建标准实体清单,该清单中的实体类型用于库存业务,
- 系统允许用户输入/编辑库存数量,以维护库存信息(规范的库存维护都是通过标准业务来进行的,一般不建议直接调库存)
- 容器是否满装规则:如果理论量!=剩余量,则满装为 false
- 托盘是否满装规则:托盘下存在不满装的容器: 满装为 false,其他情况均为 true

---

## 1. 库存的分层系统

- 库存管理的分层管理遵循工厂的分层物理模型: 企业,厂区,区域,位置
- 允许托盘和容器的混合存储.
- 主要的相关业务
  - 存储库位的描述
  - 为每颗料配置默认库区与备用库区
  - 物料的包装和接收
  - 物料的的存储和移动
- 厂区+区域+位置（库区）+库位 定义了单个库位的唯一标识,用于精确识别库位
- 不在描述通用的工厂模型,本部分主要介绍库区与库位的相关业务
- 结构图:![pic](/pics/库存_结构.png)

---

## 2. 库存区段

- 类型为仓库的区段的相关库存信息查询,详见常规查询
- 可用作车间库/线边仓

---

## 3. 库区

### 3.1 介绍

- 处于位置级别,用来管理库位
- 库区用来分组管理库位,库区不会重叠,即一个库位只能属于一个库区.
- 库区与库位相比,提供了更高的角度来查看库存信息,如:用户可以定义一个或多个取样库区,冷藏库区,以满足物料存储使用的特殊要求.
  - 物料中有与库区相关的设定:默认/备用的托盘/容器库区
- 库区数据是计算托盘/容器目标库位的的基础数据的组成部分

### 3.2 界面说明

- 主界面: ![pic](/pics/库存_库区.png)
- 编辑库区信息: ![pic](/pics/库存_库区_编辑.png)
- 关联库位: ![pic](/pics/库存_库区_库位关联.png)
- ~~厂区编码:通过区域可获取,不可编辑~~
- ~~区域编码:通过位置可获取,不可编辑~~
- 区段编码:通过位置可获取,不可编辑

### 3.3 字段说明

- 库区代码长度限制为固定长度 4;其他约束满足系统 code 的统一约束
- 详见 schema 设计

### 3.4 操作说明

#### 3.4.1 排序筛选

- 主界面-库区列表
  - 排序
    - 默认排序: 按照编码升序
    - 字段范围:编码,名称,创建时间,修改时间
      - (暂不实现)厂区,区域,区段,位置
  - 筛选
    - 默认筛选: 无
    - 字段范围:编码,名称,厂区,区域,区段,位置,创建时间,修改时间
    - 支持扫码查询
- 主界面-库区库位信息
  - 排序
    - 默认排序: 按照编码升序
    - 字段范围:库位编码,库位名称
  - 筛选
    - 默认筛选: 无
    - 字段范围:库位编码,库位名称
    - 支持扫码查询

#### 3.4.2 新增

- 按照 schema 约束添加新记录,参考"编辑库区信息"界面
- 编码手动录入,符合字段要求
- 名称手动录入,可选项
- 厂区,区域,位置从已有厂区,区域和位置中选择,遵循已有厂区,区域与位置的关联约束,区段通过位置获取,不可编辑

#### 3.4.3 编辑

- 除编码不可编辑外,其他与新增操作相同

#### 3.4.4 删除

- 清除所选记录
- 已被库位使用时,不可删除.
- 被物料使用时,该库区不可删除.
  - 物料的默认托盘/容器库区所使用的库区,提示用户"无法删除,该库区为物料 XX 的默认托盘/容器库区"
  - 物料的备用托盘/容器库区所使用的库区,提示用户"无法删除,该库区为物料 XX 的备用托盘/容器库区"
  - 物料的取样库区所使用的库区,提示用户"无法删除,该库区为物料 XX 的取样库区"

#### 3.4.5 刷新

- 获取服务端最新数据

#### 3.4.6 标签

- 打印库区标签
  - 打印内容:库区编码,库区名称
  - 打印数量:用户指定
  - 打印范围:筛选出的库区列表中的所有库区

#### 3.4.7 关联

- 参考界面"关联库位",进行库区与库位的关联或反操作.
- 取消关联的限制
  - 物料的默认托盘/容器库区所使用的库区,该库区下至少应保留一个有容量限制的库位,提示用户"无法删除,该库位为物料 XX 的默认托盘/容器存储库区的最后一个可用库位"
  - 物料的备选托盘/容器库区所使用的库区,该库区下至少应保留一个不限容量的库位,提示用户"无法删除,该库位为物料 XX 的备用托盘/容器存储库区的最后一个可用库位"
  - 物料的取样库区,该库区下至少应保留一个不限容量的库位,提示用户"无法删除,该库位为物料 XX 的取样库区的最后一个可用库位"

---

## 4. 库位

### 4.1 介绍

- EBR 可以对工厂的仓库库位进行管理;托盘和物料容器从接受到生产使用,都在使用这些库位.
- 库位创建完成后,可以通过库区来组织库位
- 库存特性
  - 库位定义了存储容量/无限容量（mass storage）
  - 库位用于存储托盘或容器
  - 还可以为库位定义质量限制,包括质量,高度,单批或多批的存储限制

### 4.2 界面说明

- 主界面: ![pic](/pics/库存_库位.png)
- 编辑库位信息: ![pic](/pics/库存_库位_编辑.png)
- 厂区,区域,区段的代码与工厂信息中的厂区,区域,区段的约束相同
- 厂区: 区域关联的厂区
- 区域: 位置（库区的位置）关联的区域
- 区段: 位置（库区的位置）关联的区段
- 库区: 库位所属库区

### 4.3 字段说明

- 库位代码长度限制为 1-6;其他约束满足系统 code 的统一约束
- 库位类型:库位的类型,来自枚举字段 EmplacementType
- 实体数量:属于该库位的实体（托盘或容器）的数量
- 实体类型:引用的实体的类型
- 总容量: 该库位的总容量,等价转换到 P1/C1 表示,系统统计值
- 剩余容量: 该库位的剩余容量,等价转换到 P1/C1 表示,系统统计值
  - 编辑界面的剩余容量:为剩余容量百分百=剩余容量/总容量;
  - 不限容量的库位该值为空
- 预留容量: 该库位的预留容量,等价转换到 P1/C1 表示,系统统计值
  - 编辑界面的预留容量:为预留容量百分百=预留容量/总容量;
  - 不限容量的库位该值为空
- 使用率: 该库位的使用率,系统统计值
  - 对于有容量限制的库位,使用率=已用容量/总容量,可大于 100%
  - 对于无容量限制的库位,使用率无法用百分比表示,系统使用该库位存储的实体数量表示
- 预留率: 该库位的预留率,系统统计值
  - 对于有容量限制的库位,预留率=预留容量/总容量,可大于 100%
  - 对于无容量限制的库位,使用率无法用百分比表示,系统使用该库位预留的实体数量表示
- 无限容量:标识该库位是否是无容量限制的,不限容量的库位,没有重量,高度等限制,不限容量的库位是多批次混合存储的
- 等价剩余容量:按系统中已有的所有标准托盘/容器计算出的剩余容量
- 冷藏:是否冷藏库位,匹配物料的冷藏存储需求
- 安全:是否安全库位,匹配物料的安全存储需求
- 可分配:是否可成为存储时的目标库位
- 不允许混批:该库位是否可以存储与当前已存批次不同的批次物料.不允许混批时,只能存储同一批次
- 列表:库位的特性:设定特性后,只有特性匹配的物料才能存储在该库位
- 高度:库位距离地面的高度
- 重量限制:该限制激活后
  - 成为推荐目标库位的一个因素:超过库位的质量限制的实体（实体剩余量转换到 kg 之后）都不会以该库位为推荐的目标库位
  - 只用于控制即将存储到该库位的实体,不考虑已经存储在该库位的实体;
  - 与容量无关
  - 比对希望入库的实体(该实体的类型的重量限制设定可能会大于库位设定,但是其剩余量满足库位重量限制即可.)的剩余数量来判定是否满足重量限制.
- 高度限制:该限制激活后
  - 成为推荐目标库位的一个因素;超过库位的高度限制的实体（标准实体类型）都不会以该库位为推荐的目标库位
  - 只用于控制即将存储到该库位的实体,不考虑已经存储在该库位的实体
  - 与容量无关
  - 比对希望入库的实体类型的高度来判定是否满足高度限制.
- 补充说明:库位的重量限制与高度限制,限制的是希望入库的单个实体的重量与高度,即从实体的重量/高度属性来管理库位的使用.
- 其他详见 schema 设计

### 4.4 操作说明

#### 4.4.1 排序筛选

- 主界面-库位列表
  - 排序
    - 默认排序: 按照编码升序
    - 字段范围: 编码,名称,不限容量,实体类型,实体数量,总容量,剩余容量,预留容量
      - (暂不实现)厂区,区域,区段,库区,使用率,预配率
  - 筛选
    - 默认筛选: 无
    - 字段范围: 编码,名称,厂区,区域,区段,库区,实体类型,实体数量,
      - (暂不实现)类型,不限容量,总容量,剩余容量,预留容量,使用率,预配率
    - 支持扫码查询

#### 4.4.2 新增

- 按照 schema 约束添加新记录,参考"编辑库位信息"界面
- 编码手动录入,符合字段要求
- 名称手动录入,可选项
- 类型手动选择,默认为正常
- 厂区,区域,区段,库区只读,无需录入
- 如果启用了无限容量,那么实体数量,总容量及其单位,剩余容量,等价剩余容量,预留容量,预配率清空并失效,并且不允许使用"不允许混批",重量限制,高度限制
- 如果没有启用无限容量:那么允许配置总容量及其单位,"不允许混批",重量限制,高度限制

#### 4.4.3 编辑

- 库位编码不可编辑,其他与新增操作相同
- 如果库位为空且没有预留时,才可以编辑"不允许混批"的限制
- 如果库位为空且没有预留时,才可以编辑库位的存储的实体类型
- 如果库位已关联到库区,且该库区不包含其他的托盘存储类型的库位,且该库区已被配置到物料的默认/备用托盘库区,则该库位的实体类型不允许从托盘存储变更为容器存储;
- 如果库位已关联到库区,且该库区不包含其他的容器存储类型的库位,且该库区已被配置到物料的默认/备用容器库区,则该库位的实体类型不允许从容器存储变更为托盘存储;
- 如果库位为空且没有预留时,进行限制容量与无限容量的变更
- 如果库位已关联到库区,且该库区不包含其他的不限容量的库位,且该库区已被配置到物料的备用托盘/容器库区或取样库区,则该库位不允许从不限容量变更为限制容量的库位;
- 如果库位已关联到库区,且该库区不包含其他的限制容量的库位,且该库区已被配置到物料的默认托盘/容器库区,则该库位不允许从限制容量变更为不限容量的库位;
- 如果库位已配置为物料的初始取样库位,则该库位不允许从不限容量变更为限制容量的库位;
- 启用库位的重量限制时,所设定的重量限制需满足库位已有实体的重量要求,否则不允许启用.
  - 检测输入的重量限制,是否满足已在库存存储的容器/托盘的`类型`的重量限制设定
- 启用库位的高度限制时,所设定的高度限制需满足库位已有实体的高度要求,否则不允许启用
  - 检测输入的高度限制,是否满足已在库存存储的容器/托盘的`类型`的高度限制设定

#### 4.4.4 删除

- 清除所选记录
- 删除后,将该库位从库区关联的库位中移除.
- 检验该库位是否为空,不是空库位时,不允许删除
  - 该库位是某些托盘的当前库位,提示用户"无法删除,库位 XX 是托盘 XX 的当前库位"
  - 该库位是某些容器的当前库位,提示用户"无法删除,库位 XX 是容器 XX 的当前库位"
- 库位有预留时,不允许删除库位.
- 被物料使用时,该库位不可删除.
  - 物料的默认托盘/容器库区所使用的库区,该库区下至少应保留一个有容量限制的库位,提示用户"无法删除,该库位为物料 XX 的默认托盘/容器库区的最后一个可用库位"
    - 被物料的默认托盘库区使用:至少保留一个有容量限制的托盘类型的库位
    - 被物料的默认容器库区使用:至少保留一个有容量限制的容器类型的库位
  - 物料的备选托盘/容器库区所使用的库区,该库区下至少应保留一个不限容量且类型匹配的库位,提示用户"无法删除,该库位为物料 XX 的备用托盘/容器库区的最后一个可用库位"
  - 物料的取样库区,该库区下至少应保留一个不限容量的库位,提示用户"无法删除,该库位为物料 XX 的取样库区的最后一个可用库位"
  - 物料的初始取样库位使用该库位时,提示用户"无法删除,该库位为物料 XX 的取样初始库位"
- 被批次接收使用时,不允许删除
  - 被批次接收的初始库位,取样库位,目标库位使用时,不允许删除

#### 4.4.5 刷新

- 获取服务端最新数据

#### 4.4.6 标签

- 打印库位标签
  - 打印内容:库位编码,库位名称
  - 打印数量:用户指定
  - 打印范围:筛选出的库位列表中的所有库位

---

## 5. 供应商管理

### 5.1 介绍

- 对供应物料的供应商提供简单管理

### 5.2 界面说明

- 主界面:![pic](/pics/库存_供应商.png)
- 编辑界面:![pic](/pics/库存_供应商_编辑.png)

### 5.3 字段说明

- 详见 schema 设计

### 5.4 操作说明

#### 5.4.1 排序筛选

- 主界面-供应商列表
  - 排序
    - 默认排序: 按照编码升序
    - 字段范围: 编码,名称,地址 1,地址 2,地址 3,地址 4,级别,通讯地址,电话号码 1,电话号码 2,传真号码
  - 筛选
    - 默认筛选: 无
    - 字段范围: 编码,名称,地址 1,地址 2,地址 3,地址 4,级别,通讯地址,电话号码 1,电话号码 2,传真号码

#### 5.4.2 新增

- 添加一个新的供应商
- 编码和名称必填
- 编码和名称之外的其他信息选填,暂不做校验

#### 5.4.3 编辑

- 除编码不可编辑外,其他与新增操作相同

#### 5.4.4 删除

- 删除一个供应商
- 删除限制:被接收单使用的供应商不允许被删除,异常信息“该供应商已被接收单使用”

#### 5.4.5 刷新

- 获取服务端最新数据

---

## 6. 托盘管理

### 6.1 标准托盘

#### 6.1.1 介绍

- 托盘类型:使用托盘类型来表示标准托盘
- 标准托盘为以下功能提供了基础
  - 不同托盘库位的存储容量的计算
  - 可用空间的计算
  - 按托盘进行批次接收时的建议目标库位

#### 6.1.2 界面说明

- 标准托盘列表: ![pic](/pics/库存_托盘类型_列表.png)
- 明细界面: ![pic](/pics/库存_托盘类型_新增编辑.png)

  - 类型
    - 系统内置 P1 标准托盘,数据如下:
      - ![pic](/pics/库存_托盘类型_内置P1.png)
      - P1 与托盘的重量,基本类型挂钩,是系统正常运行所需的最小信息量
    - 系统提供内置类型清单的 P1-P99,共 99 种标准托盘,以满足用户使用多种标准托盘的需求;不同的类型用来表达不同托盘的存储容量;实际情况中,库房,生产车间,包装间所用的托盘类型可能不同,即不同库位可能使用不同的标准托盘,因此系统需提供多种标准托盘供用户使用.
    - 新建时从列表中选择,创建后该字段不可编辑;
    - 托盘类型需以 P1 为基础类型,其余所有托盘都需与 P1 有个比例关系,如 P2=1.5P1;类型不能重复
  - 皮重单位: 系统以列表形式提供,使用 MASS_UNIT2

#### 6.1.3 字段说明

- 类型:托盘类型,详见【界面说明】中【类型】的说明
- 名称:托盘名称
- 高:以 cm 为单位,取值范围为>= 0 的整数.托盘的高度在一定情况下需满足库位的高度要求;
  - 在托盘接收或创建,目标库位会使用该字段进行兼容性验证;其他托盘与库位发生关联时,也会使用该字段进行验证
- 长:以 cm 为单位,取值范围为>= 0 的整数.
- 宽:以 cm 为单位,取值范围为>= 0 的整数.
- 平均质量:以 kg 或 g 为单位,取值范围为>= 0 的浮点数,精度为 3 位小数.托盘的平均质量一定情况下需满足库位的质量要求;
  - 在托盘接收或创建,目标库位会使用该字段进行兼容性验证;其他托盘与库位发生关联时,也会使用该字段进行验证
- 比例:对基础类型 P1 的权重系数;取值范围为>= 0 的浮点数,精度为 2 位小数.
  - 系数的标准:可以是托盘类型的体积,质量甚至宽度,由用户决定使用哪个,系统没有强制管控与换算,基于这个主要标准,用户设定该托盘类型与 P1 的权值,以表达该托盘与 P1 的相关性
  - 如果用户认为所有托盘都是等价的,那么可以将所有其他托盘的比例系数全部设定为 1,这时,对系统而言每个标准托盘也无不同.
- 皮重:托盘的皮重;取值范围为>= 0 的浮点数,精度为 3 位小数.
- 皮重单位:托盘的皮重的单位;使用 MASS_UNIT2

#### 6.1.4 操作说明

##### 6.1.4.1 排序筛选

- 主界面-标准托盘列表
  - 排序
    - 默认排序: 按照类型编码升序
    - 字段范围: 类型,名称,高,长,宽,平均质量,比例,皮重,皮重单位
  - 筛选
    - 默认筛选: 无
    - 字段范围: 类型,名称,高,长,宽,平均质量,比例,皮重,皮重单位

##### 6.1.4.2 添加

- 添加满足字段约束的新托盘类型,添加新类型时,已经使用的类型,在新建时的类型列表中不显示.

##### 6.1.4.3 编辑

- 编辑现有托盘类型的信息,编辑时,类型字段为只读;基础类型 P1 也是可编辑的
- 如果编辑的是标准托盘高度和平均质量信息,那么系统需验证高度与平均质量的新值是否满足库位（使用该容器类型定义的库位）上高度与质量的约束,如果不满足,需提示用户取消库位上对应的限制后,再修改标准托盘的高度或平均质量信息.
- 已删除检查(暂不实现):验证所选项是否已被删除,如果已被删除,需提示用户:"该类型刚被删除了".
- 同时编辑检查(暂不实现):需要在操作前, 验证所选项正在被别的用户编辑,如果是,则不允许更新和删除类型的操作,并提示用户:"该类型正在被另一个用户编辑,请稍后再试".

##### 6.1.4.4 删除

- P1 类型不可删除.
- 验证资源是否被占用,
  - 验证所选项是否被库位使用,如果是,则不允许删除,并提示用户"当前托盘类型 XX 在库位的定义中使用,不允许删除"
  - 验证所选项是否被托盘使用,如果是,则不允许删除,并提示用户"当前托盘类型 XX 在托盘的定义中使用,不允许删除"
  - 验证所选项是否被托盘包装方式使用,如果是,则不允许删除,并提示用户"当前托盘类型 XX 在托盘包装方式的定义中使用,不允许删除"
- 已删除检查(暂不实现):验证所选项是否已被删除,如果已被删除,需提示用户:"该类型刚被删除了".
- 同时编辑检查(暂不实现):需要在操作前, 验证所选项正在被别的用户编辑,如果是,则不允许更新和删除类型的操作,并提示用户:"该类型正在被另一个用户编辑,请稍后再试".

##### 6.1.4.5 刷新

- 获取服务端最新数据

#### 6.1.5 标准托盘与库存容量管理

- 系统基于 P1 和 P1 的权值（其他托盘类型）来计算所有库位和库区的库存能力.
- 用户对托盘库位描述的越精确,EBR 对库存容量的管理就越精确.

---

### 6.2 托盘包装方式

#### 6.2.1 按照物料+供应商编码来维护托盘的包装方式,用于批次接收时的托盘包装:

- 计算托盘的总容量
- 计算托盘个数

#### 6.2.2 UI 示例如下:

- 托盘包装方式列表:![pic](/pics/批次_托盘包装方式列表.png)
- 明细界面:![pic](/pics/批次_托盘包装方式明细.png)

#### 6.2.3 字段说明(列表+明细):

- 物料编码: 来自物料表中已验证的物料;列表选择;创建后不可编辑
- 物料名称: 通过料号获取,不可编辑
- 物料类型: 通过料号获取,不可编辑
- 供应商编码: 来自供应商表;创建后不可编辑
- 供应商名称: 通过供应商获取,不可编辑
- 托盘类型: 来自托盘类型表;可编辑
- 托盘类型名称: 通过托盘类型获取,不可编辑
- 托盘皮重: 默认值为所选类型的皮重, 可编辑
- 托盘皮重单位: 默认值为所选类型的皮重的单位;可编辑
- 容器类型: 来自容器类型表;可编辑
- 容器类型名称:通过容器类型获取,不可编辑
- 容器皮重: 默认值为所选类型的皮重, 可编辑
- 容器皮重单位: 默认值为所选类型的皮重的单位;可编辑
- 容器数/托盘: 每个托盘上的容器个数
  - 如果物料的打标类型(``SampleLabelType```)为 P:该值固定为 1,不可编辑
  - 如果物料的打标类型(``SampleLabelType```)不为 P ,则可编辑
- 容器容量: 单个容器的容量;可编辑
- 容器容量单位: 物料的库存单位;不可编辑
- 二次包装方式: 二次包装的说明;可编辑;如 该 pallet 上的容器数是 1, 分 10 盒装,每盒装 500 个,那么二次包装的说明为 10\*500

#### 6.2.4 操作说明:

##### 6.2.4.1 排序筛选

- 主界面-托盘包装方式列表
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,物料类型
      - (暂不实现)供应商编码,供应商名称
  - 筛选
    - 默认筛选: 无
    - 字段范围: 物料编码,物料名称,物料类型,供应商编码,供应商名称

##### 6.2.4.2 新增

- 物料编码:选择系统中已验证的物料编码,列表选择;创建后不可编辑;必填项
- 物料名称:通过物料编码获取;必填项
- 物料类型:通过物料编码获取
- 供应商编码:选择系统中已有供应商编码,列表选择;创建后不可编辑;必填项
- 供应商名称:通过供应商编码获取
- 托盘类型: 用户选取系统已有托盘类型;必填项
- 托盘类型名称: 通过托盘类型获取
- 托盘皮重: 用户输入;必填项
- 托盘皮重单位: 用户选取系统已有单位;必填项
- 容器类型: 用户选取系统已有容器类型;必填项
- 容器类型名称:通过容器类型获取
- 容器皮重: 用户输入;必填项
- 容器皮重单位: 用户输入;必填项
- 容器数/托盘: 必填项
  - 如果物料的打标类型(``SampleLabelType```)为 P:该值固定为 1,不可编辑
  - 如果物料的打标类型(``SampleLabelType```)不为 P ,则可编辑
- 容器容量: 用户输入;必填项
- 容器容量单位: 通过物料编码获取的库存单位;不可编辑
- 二次包装方式: 用户输入;可选项

##### 6.2.4.3 编辑

- 除物料编码,物料名称,物料类型,供应商编码,供应商名称不可编辑外,其他与新增相同.

##### 6.2.4.4 删除

- 无限制

##### 6.2.4.5 刷新

- 获取服务端最新数据

---

### 6.3 托盘管理

#### 6.3.1 介绍

- 托盘的管理,主要功能有托盘的创建,移动,返回,删除,明细,标签重新打印
  - 不对虚拟托盘进行管理

#### 6.3.2 界面说明

- 主界面:![pic](/pics/库存_托盘_列表.png)
- 托盘添加:![pic](/pics/库存_托盘_添加.png)
- 托盘明细:同[库存查询_库存查询_实体明细]
- 托盘移动:![pic](/pics/库存_托盘_移动.png)
- 托盘返回:![pic](/pics/库存_托盘_返回.png)

#### 6.3.3 字段说明

##### 6.3.3.1 字段说明-库存列表

- 厂区:通过库位所属库区的位置获得
- 区域:通过库位所属库区的位置获得
- 区段:通过库位所属库区的位置获得
- 库区:库位所属库区
- 托盘编号:系统中已有的托盘编号,~~非系统虚拟托盘时显示该值~~
- 托盘类型:通过托盘编号获取
- 托盘状态:通过托盘编号获取,枚举值`PalletStatus`
- 批次号:托盘所属批次号
- 物料编码:托盘所存的物料编码
- 物料名称:物料编码对应的物料名称
- 剩余量:托盘的总剩余量
- 单位:剩余量所用单位
- 订单号:创建该批次的订单号,批次接收中为接收单号
- 次序号:订单号相关的次序号
- 最后操作日期:操作该托盘的事务的发生日期.
- 原始库位: 该托盘中的物料上设定的初始库位
- 取样库位: 该托盘中的物料上设定的取样库位
- 目标库位: 系统推荐的存储该托盘的库位.
- 其他见 schema 设计

##### 6.3.3.2 字段说明-添加

- 托盘类型:从标准托盘中选择,必填项
- 托盘类型名称:按照所选托盘类型获取,不可编辑
- 批次号:必须为已有批次,必填项
- 批次状态:按照所用的批次号获取,不可编辑
- 物料编码:通过批次号获取,不可编辑
- 物料名称:通过批次号获取,不可编辑
- 标准容量:必须大于 0,必填项
- 托盘编号:为已有的最大托盘编码+1
- 托盘状态:使用托盘状态枚举,不可编辑
- 初始位置:遵循位置推荐规则(同批次接收),必填项
- 初始位置名称:依据初始位置编号获取,不可编辑
- 取样位置:遵循取样位置使用规则(同批次接收)
- 取样位置名称:依据取样位置编号获取,不可编辑
- 目标位置:遵循目标位置使用规则(同批次接收),必填项
- 目标位置名称:依据目标位置编号获取,不可编辑
- 其他见 schema 设计

##### 6.3.3.3 字段说明-明细

- 托盘类型名称:按照所选托盘类型获取,不可编辑
- 标准容量:容器的标准容量,不可编辑
- 剩余量:容器当前的剩余量,不可编辑
- 容器列表部分见容器相关字段.
- 其他见 schema 设计

#### 6.3.4 操作说明

##### 6.3.4.1 排序筛选

- 主界面-托盘列表
  - 排序
    - 默认排序:按照托盘编码升序
    - 字段范围:托盘编码,初始库位
      - (暂不实现)批次号
  - 筛选
    - 默认筛选:无
    - 字段范围:厂区,区域,区段,库区,库位,批次号,物料编码,托盘编号
      - (暂不实现)托盘状态
    - 支持扫码查询

##### 6.3.4.2 添加

- 将一个新托盘添加到指定批次,托盘编码按照托盘编码规则生成
  - 维护信息有:托盘编码,物料编码,批次号,托盘类型,托盘状态,最后操作日期,初始库位,取样库位,目标库位,是否满装(固定值 true),标准容量及单位(创建托盘时输入的数量及单位),托盘序号(固定值 1),托盘数量(固定值 1)
    - 托盘状态:不需取样的为:待入库,~~需取样的为待取样(新增的待取样托盘其实无法进行后续操作)~~
      - 目前均按照不需取样处理,不考虑需检验批次的取样规则,后续有具体项目需要,再丰富该功能
      - 待入库的托盘通过[移动]]功能完成入库操作;
        - (暂不实现)移动前后可以进行托盘的合并/拆分操作, 后续方案如下
          - 系统内置特殊接收单: 事务类型(--),物料接收的单号(------),物料接收的序号(----)
          - 新建托盘/容器的业务:使用固定值填充字段:事务类型(--),物料接收的单号(------),物料接收的序号(----)
  - 不需要维护的信息有:事务类型,物料接收的单号,物料接收的序号,皮重,皮重单位
  - 更新目标库位的预留容量信息
    - 新创建的托盘是计划入到目标库位的,移动后扣除目标库位的预留,见[移动]功能说明

##### 6.3.4.3 明细

- 链接到[库存查询_库存查询_实体明细]

##### 6.3.4.4 删除

- 只能删除空托盘(剩余量<=0 的托盘)
- 释放库位的剩余容量
- 删除指定的托盘,及该托盘下的所有容器

#### 6.3.4.5 移动

- 移动业务与托盘的状态相关
- 移动类型:
  - 移动到托盘库位
- 移动规则:
  - 非已标签托盘,不可移动
  - 待取样托盘,只可移动到取样库位,使用托盘上的取样库位
    - (暂不实现)使用所有不限容量的库位
  - 待入库/已入库托盘,用户从可用库位列表中直接指定有效目标库位,需要通知系统位置的变化
    - [批次接收]-[字段说明-包装接收]-[目标库位]的可选库位范围
  - (暂不实现)托盘/托盘中有容器已指派给领料时,需提示用户是否执行该操作.
- 移动方式:
  - 将托盘移动到新库位
- 移动后
  - 移动后更新库存(Inv)信息,按照料号+批号+库位号
  - 移动后,更新托盘位置信息.
  - 移动后,更新相关(限制容量的)库位剩余容量信息.
  - 移动操作是一种库存调整操作.
    - 移动手动创建的托盘,相当于将托盘从初始库位将托盘移动到目标库位

#### 6.3.4.6 返回

- 将托盘返回到它先前的库位,即最后一次移动的反操作

#### 6.3.4.7 刷新

- 获取服务端最新数据

#### 6.3.4.7 重打标

- 重新打印托盘标签:打印所选定的托盘标签

---

### 6.4 托盘拆分

#### 6.4.1 介绍

- 将源托盘上容器部分或全部转移到同批次的目标托盘上

#### 6.4.2 界面说明

- 托盘拆分:![pic](/pics/库存_托盘_拆分.png)
- 容器选择:![pic](/pics/库存_托盘_拆分_容器选择.png)

#### 6.4.3 字段说明

- 见托盘的 schema 设计

#### 6.4.4 操作说明

##### 6.4.4.1 排序筛选

- 托盘拆分
  - 排序:默认按照托盘编码升序
  - 筛选
    - 按照界面筛选条件筛选: 厂区,区域,库区必填,物料编码与批次号必填一个,其他条件选填
    - 支持扫码查询
- 容器选择
  - 排序:默认按照容器序号升序
  - 筛选:无

##### 6.4.4.2 拆分

- 将源托盘上容器部分或全部转移到目标托盘上，若源托盘上无容器，则提示"无法拆分托盘.托盘（PXXXXX）为空"
- 指定源托盘后,目标托盘清单中显示的是与源托盘同批次的其他托盘
- 可拆分托盘的限制条件
  - 非虚拟托盘
  - 托盘状态为:待入库/已入库
  - 托盘所属的批次接收状态为:已出标/已取样/待入库/已入库

##### 6.4.4.3 刷新

- 获取服务端最新数据

---

### 6.5 托盘合并

#### 6.5.1 介绍

- 将一个托盘上的容器全部转移到目标托盘,用户可选择是否删除原托盘.

#### 6.5.2 界面说明

- 托盘合并:![pic](/pics/库存_托盘_合并.png)

#### 6.5.3 字段说明

- 见托盘的 schema 设计

#### 6.5.4 操作说明

##### 6.5.4.1 排序筛选

- 托盘合并
  - 排序:默认按照托盘编码升序
  - 筛选
    - 按照界面筛选条件筛选: 厂区,区域,库区必填,物料编码与批次号必填一个,其他条件选填
    - 支持扫码查询

##### 6.5.4.2 合并

- (暂不实现)在托盘拆分和合并时,如果容器已指派给领料,且拆分与合并影响到了容器库位,需提示用户是否执行该操作.
- 将源托盘上的容器全部转移到目标托盘上，若源托盘上无容器，则提示"托盘 PXXXXX 为空，不能合并";
- 根据用户的选择系统进行托盘删除的处理,默认为不删除;若用户选择删除,则请用户确认.
- 可合并托盘的限制条件
  - 非虚拟托盘
  - 托盘状态为:待入库/已入库
  - 托盘所属的批次接收状态为:已出标/已取样/待入库/已入库

##### 6.5.4.3 刷新

- 获取服务端最新数据

---

### 6.6 托盘追溯

- 追溯内容:
  - <常规字段>
  - 业务追溯字段:
    - palletNo: 托盘编号
    - palletStatus: 托盘状态
    - originalEmplacement: 初始库位
    - 初始库位名称,通过编码获取
    - targetEmplacement: 目标库位
    - 目标库位名称,通过编码获取
    - lotNo: 批次号
    - lotStatus: 批次状态
    - materialCode: 物料编码
    - materialName: 物料名称
    - Qty: 最终数量
    - unit: 单位
- 排序
  - 默认排序: 按照操作时间降序
- 筛选
  - 默认筛选: 无
  - 字段范围: <常规字段>,托盘编号,批次号
- 打印
  - 按照指定格式打印筛选出的追溯内容

---

## 7. 容器管理

### 7.1 标准容器

#### 7.1.1 介绍

- 容器类型的管理与托盘类型相同
- 容器类型:使用容器类型来表示标准容器
- 标准容器为以下功能提供了基础
  - 不同容器库位的存储容量的计算
  - 可用空间的计算
  - 按容器进行批次接收时的建议目标库位

#### 7.1.2 界面说明

- 类型清单: ![pic](/pics/库存_容器类型_列表.png)
- 明细界面: ![pic](/pics/库存_容器类型_新增编辑.png)
  - 类型
    - 系统内置 C1 标准容器,数据如下:
      - ![pic](/pics/库存_容器类型_内置C1.png)
      - C1 与容器的重量,基本类型挂钩,是系统正常运行所需的最小信息量
    - 系统提供内置类型清单的 C1-C99,共 99 种标准容器,以满足用户使用多种标准容器的需求;不同的类型用来表达不同容器的存储容量;实际情况中,库房,生产车间,包装间所用的容器类型可能不同,即不同库位可能使用不同的标准容器,因此系统需提供多种标准容器供用户使用.
    - 新建时从列表中选择,创建后该字段不可编辑;
    - 容器类型需以 C1 为基础类型,其余所有容器都需与 C1 有个比例关系,如 C2=1.5C1;类型不能重复
  - 皮重单位: 系统以列表形式提供,使用 MASS_UNIT2

#### 7.1.3 字段说明

- 类型:容器类型,详见【界面说明】中【类型】的说明
- 名称:容器名称
- 高:以 cm 为单位,取值范围为>= 0 的整数.容器的高度在一定情况下需满足库位的高度要求;
  - 在容器接收或创建,目标库位会使用该字段进行兼容性验证;其他容器与库位发生关联时,也会使用该字段进行验证
- 长:以 cm 为单位,取值范围为>= 0 的整数.
- 宽:以 cm 为单位,取值范围为>= 0 的整数.
- 平均质量:以 kg 或 g 为单位,取值范围为>= 0 的浮点数,精度为 3 位小数.容器的平均质量一定情况下需满足库位的质量要求;
  - 在容器接收或创建,目标库位会使用该字段进行兼容性验证;其他容器与库位发生关联时,也会使用该字段进行验证
- 比例:对基础类型 C1 的权重系数;取值范围为>= 0 的浮点数,精度为 2 位小数.
  - 系数的标准:可以是容器类型的体积,质量甚至宽度,由用户决定使用哪个,系统没有强制管控与换算,基于这个主要标准,用户设定该容器类型与 C1 的权值,以表达该容器与 C1 的相关性
  - 如果用户认为所有容器都是等价的,那么可以将所有其他容器的比例系数全部设定为 1,这时,对系统而言每个标准容器也无不同.
- 皮重:容器的皮重;取值范围为>= 0 的浮点数,精度为 3 位小数.
- 皮重单位:容器的皮重的单位;使用 MASS_UNIT2

#### 7.1.4 操作说明

##### 7.1.4.1 排序筛选

- 主界面-标准容器列表
  - 排序
    - 默认排序: 按照类型编码升序
    - 字段范围: 类型,名称,高,长,宽,平均质量,比例,皮重,皮重单位
  - 筛选
    - 默认筛选: 无
    - 字段范围: 类型,名称,高,长,宽,平均质量,比例,皮重,皮重单位

##### 7.1.4.2 添加

- 添加:添加满足字段约束的新容器类型,添加新类型时,已经使用的类型,在新建时的类型列表中不显示.

##### 7.1.4.3 编辑

- 编辑现有容器类型的信息,编辑时,类型字段为只读;基础类型 C1 也是可编辑的
- 已删除检查(暂不实现):验证所选项是否已被删除,如果已被删除,需提示用户:"该类型刚被删除了".
- 同时编辑检查(暂不实现):需要在操作前, 验证所选项正在被别的用户编辑,如果是,则不允许更新和删除类型的操作,并提示用户:"该类型正在被另一个用户编辑,请稍后再试".
- 如果编辑的是标准容器高度和平均质量信息,那么系统需验证高度与平均质量的新值是否满足库位（使用该容器类型定义的库位）上高度与质量的约束,如果不满足,需提示用户取消库位上对应的限制后,再修改标准容器的高度或平均质量信息.

##### 7.1.4.4 删除

- C1 类型不可删除
- 已删除检查(暂不实现):验证所选项是否已被删除,如果已被删除,需提示用户:"该类型刚被删除了".
- 同时编辑检查(暂不实现):需要在操作前, 验证所选项正在被别的用户编辑,如果是,则不允许更新和删除类型的操作,并提示用户:"该类型正在被另一个用户编辑,请稍后再试".
- 验证资源是否被占用,
  - 验证所选项是否被库位使用,如果是,则不允许删除,并提示用户"当前容器类型 XX 在库位的定义中使用,不允许删除"
  - 验证所选项是否被容器使用,如果是,则不允许删除,并提示用户"当前容器类型 XX 在容器的定义中使用,不允许删除"
  - ~~验证所选项是否被容器包装方式使用,如果是,则不允许删除,并提示用户"当前容器类型 XX 在容器包装方式的定义中使用,不允许删除"~~

##### 7.1.4.5 刷新

- 获取服务端最新数据

#### 7.1.5 标准容器与库存容量管理

- 系统基于 C1 和 C1 的权值（其他容器类型）来计算所有库位和库区的库存能力.
- 用户对容器库位描述的越精确,EBR 对库存容量的管理就越精确.

### 7.2 容器取样

#### 7.2.1 界面说明

- UI 示例如下:  
  ![pic](/pics/库存_容器取样.png)
  - 取样单位: 物料的库存单位,下拉框,只读
- 字段说明:
  - 厂区: 通过位置号获取
  - 区域: 通过位置号获取
  - 区段: 通过位置号获取
  - 库区: 通过库位号获取
  - 库位: 当前库位,通过托盘号获取
  - 容器 ID: 来自容器表
  - 物料编码: 来自容器表
  - 物料名称: 通过料号获取
  - 批次号: 来自容器表
  - 容器状态: 来自容器表
  - 托盘编码: 来自托盘表
  - 取样数: 取样的次数,来自容器表
  - 剩余数量: 来自容器表
  - 单位: 通过料号获取,来自物料表,库存单位

#### 7.2.2 操作说明

##### 7.2.2.1 排序筛选

- 主界面
  - 排序
    - 默认排序: 按照容器 ID 升序
    - 字段范围: 容器 ID
      - (暂不实现)库位
  - 筛选
    - 默认筛选: 无
    - 字段范围: 厂区,区域,区段,库区,库位,批次号,物料编码,物料名称
      - (暂不实现)容器状态,取样状态
    - 支持扫码查询

##### 7.2.2.2 驳回

- 同[批次管理]-[驳回容器]

##### 7.2.2.3 锁定

- 同[批次管理]-[锁定容器]

##### 7.2.2.4 取样

- 一个已取样的容器可以重新取样,重新取样需要填写说明
- 必须输入取样量,取样量的默认值来自物料上取样量的设定
- 更新容器的取样状态到"已取样"
- 更新容器的剩余数量: 剩余数量= 当前剩余数量 - 取样量
- 更新容器的已取样量: 已取样数= 当前已取样数 + 1
- (按照该容器所在库位+批次号+料号)更新库存表(Inv)的库存量: 库存量= 当前库存量 - 取样量
- 批次的取样状态更新:开始取样后,该状态为"取样中",所有的容器取样完成后,该状态为"已取样";批次不需取样的也为`True`
- 该容器所属托盘的所有取样完成后,需更新该容器所在的托盘的"状态": "等待取样"->"等待入库";不需取样的直接到"等待入库"
- 批次接收的取样完成之后,批次接收的是否已取样为`True`,批次接收不需取样也为`True`
- 更新批次的取样日期为当前取样时间
- 取样操作图示:![pic](/pics/库存_容器取样_操作说明.png)

##### 7.2.2.5 刷新

- 获取服务端最新数据

##### 7.2.2.6 其他说明

- 驳回和锁定不支持多选, 取样支持多选

### 7.3 容器管理

#### 7.3.1 介绍

- 容器的管理,主要功能有容器移动,拆分,返回,标签重新打印

#### 7.3.2 界面说明

- 主界面:![pic](/pics/库存_容器管理.png)
- 明细:![pic](/pics/库存_容器管理_容器明细.png)
- 容器状态:![pic](/pics/库存_容器管理_容器状态.png)
- 移动:![pic](/pics/库存_容器管理_容器移动.png)
- 拆分:![pic](/pics/库存_容器管理_容器拆分.png)
- 返回:![pic](/pics/库存_容器管理_容器返回.png)
- 设备字段界面可以暂不显示

#### 7.3.3 字段说明

- 厂区:通过库位所属库区的位置获得
- 区域:通过库位所属库区的位置获得
- 区段:通过库位所属库区的位置获得
- 库区:库位所属库区
- 库位:库存位置,容器当前所处的库位(容器所属虚拟托盘所属库位)
- 条码:容器的条码 ID
- 容器类型:属于哪种标准容器
- 托盘编号:存储容器的托盘编号,非系统虚拟托盘时显示该值
- 物料编码:容器所存的物料编码
- 物料名称:物料编码对应的物料名称
- 批次号:容器所存的物料的批次号
- 结束容器:容器剩余余量<=0 的容器为结束容器
- 容器状态:容器的状态
- 剩余量:容器的总剩余量
- 单位:剩余量所用单位
- 设备(该字段目前全部为空):容器被分配指派的设备
- 是否满装:容器所属托盘的满装状态
- 其他见 schema 设计

#### 7.3.4 操作说明

##### 7.2.2.1 排序筛选

- 主界面
  - 排序
    - 默认排序: 按照容器 ID 升序
    - 字段范围: 容器 ID
      - (暂不实现)设备,库位
  - 筛选
    - 默认筛选: 无
    - 字段范围: 厂区,区域,区段,库区,库位,批次号,物料编码,物料名称,容器 ID,
      - (暂不实现)容器状态

#### 7.3.4.2 明细

- 显示容器的明细信息
- 托盘明细
  - 显示存储该容器的托盘的详细信息,链接到[库存管理-托盘管理-明细]
- 编辑:
  - 编辑容器的打开状态:设置为打开状态后,有效期将按照 MIN("当前日期+开袋有效期",批次有效期)自动计算
  - 有效期可以手动设定,不能超过批次有效期
  - 如果批次有效期被调整,且小于容器有效期, 则系统需将容器有效期自动调整为批次有效期

#### 7.3.4.3 容器状态

- 允许修改被驳回/锁定的容器的状态
- 容器驳回/锁定的反操作.
- 显示所选容器 ID. 所选容器的相关信息:批次号,容器序号,物料编码,物料名称,当前状态,新状态,是否打开,有效期等

#### 7.3.4.4 移动

- 移动业务与容器的状态相关
- 移动类型:
  - 移动到容器库位,可以进选择库位,不可选择托盘
  - 移动到同批次的托盘,可以进选择托盘,不可选择库位
    - 虚拟托盘不支持移动,即使用虚拟托盘的容器,不支持移动到同批次托盘
- 移动规则:
  - 非已标签容器,不可移动
    - 依据容器的标签字段来判断~~依据该容器所属接收批次的批次接收状态来判定是否已经出标~~
    - 会生成新容器的业务:接收,生产声明,容器拆分,其中生产声明和容器拆分时标签自动打印,即这两者生成的容器是同时出标的
  - 待取样容器,只可移动到取样库位,使用托盘上的取样库位
    - (暂不实现)使用所有不限容量的库位
    - 待取样的容器位于常规托盘上时,不允许移动,提示"容器将要取样，无法转移!"; 只能移动该托盘
    - 依据容器取样状态判定,取样状态为`LotSampleStatus.TO_BE_SAMPLED`属于该情况
  - 待入库/已入库容器,用户从可用库位列表中直接指定有效目标库位,需要通知系统位置的变化
    - [批次接收]-[字段说明-包装接收]-[目标库位]的可选库位范围
    - 依据容器取样状态判定,取样状态为`LotSampleStatus.SAMPLED`属于该情况
  - (暂不实现)容器已指派给设备时,不能移动容器,需要使用设备的移动功能/标记/元素
  - (暂不实现)容器已指派给领料时,需提示用户是否执行该操作.
- 移动方式:
  - 将容器移动到新库位/从当前托盘移动到新库位,先解除当前托盘关联,再关联新托盘
  - 将容器移动到同批次托盘下/当前托盘移动到同批次新托盘,先解除当前托盘关联,再关联新托盘
- 移动后更新库存(Inv)信息,按照料号+批号+库位号
- 移动后,更新托盘位置信息.
  - 不维护托盘中相关的接收信息(接收之后的库存调整类业务,与接收单无直接关系):事务类型,接收订单号,接收序号
  - （暂不实现）后续方案:
    - 系统内置特殊接收单: 事务类型(--),物料接收的单号(------),物料接收的序号(----)
    - 移动业务:使用固定值填充字段:事务类型(--),物料接收的单号(------),物料接收的序号(----)
- 移动后,更新相关(限制容量的)库位剩余容量信息.

#### 7.3.4.5 拆分

- 输入容器条码进行容器拆分:默认为选择的容器条码
- 只接受已存在的容器条码,按容器条码加载该容器的信息
- 拆分数量
  - 手动输入:如果物料的可用称量模式只有手动称量或物料只在包装间称量,则只能使用手动输入
  - 读取衡器称量数据:如果物料的称量模式不含手动称量,则只能读取衡器称量数据
  - 手动输入与读取衡器称量数据皆可:如果物料兼容以上两种模式,则两种方式都可以使用
- 拆分形式
  - 可拆分为一个单独的容器,库位不变
  - 可在原托盘上拆分,库位不变
- 拆分后自动打印新容器的标签:即拆分后的容器是已经出标的容器
- 拆分后不维护托盘中相关的接收信息(接收之后的库存调整类业务,与接收单无直接关系):事务类型,接收订单号,接收序号
  -(暂不实现)后续方案：
  - 系统内置特殊接收单: 事务类型(--),物料接收的单号(------),物料接收的序号(----)
  - 拆分业务:使用固定值填充字段:事务类型(--),物料接收的单号(------),物料接收的序号(----)

#### 7.3.4.6 返回

- 将容器返回到它先前的库位,即最后一次移动的反操作
  - 按新容器库位移动之后的返回:
    - 托盘与容器的结构不返回
    - 处理当前虚拟托盘的库位返回,操作日期
    - 处理相关的库位容量信息,与库存信息
  - 按同批次托盘移动之后的返回:不支持,该类型的业务,通过移动功能,移动到之前的托盘来实现

#### 7.3.4.7 重打标

- 重新打印容器标签:打印所选定的容器标签

#### 7.3.4.8 刷新

- 获取服务端最新数据

---

## 8. 库存查询

### 8.1 库存查询

#### 8.1.1 介绍

- 查找指定厂区,区域内的库存信息,以及这些库存的库位,托盘,容器的明细信息. 主要关注库存信息

#### 8.1.2 界面说明

- 主界面: ![pic](/pics/库存_查询_库存.png)
- 概览界面: ![pic](/pics/库存_查询_库存概览.png)
- 明细界面: ![pic](/pics/库存_查询_库存明细.png)
- 明细-实体明细界面: ![pic](/pics/库存_查询_实体明细.png)
- 明细界面中的明细对应明细-实体明细

#### 8.1.3 字段说明

- 数据查询使用,无 schema.

#### 8.1.4 操作说明

##### 8.1.4.1 排序筛选

- 主界面-库位与物料列表
  - 排序
    - 默认排序:
      - (暂不实现)按照有效期升序
      - 按照物料编码升序
    - 字段范围: 物料编码,物料名称
      - (暂时实现)批次号,有效期,厂区编码,区域编码,区段编码,库区编码,库位编码
  - 筛选
    - 默认筛选: 无
    - 字段范围: 物料编码,物料名称,物料类型,批次号,厂区编码,区域编码,区段编码,库区编码,库位编码
      - (暂时实现)批次状态,取样状态
    - 支持扫码查询
- 概览
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,批次号,供应商批次,批次状态,取样状态,有效期,厂区编码,区域编码,区段编码
  - 筛选
    - 按照界面筛选条件筛选: 厂区,区域,库区,物料编码必填,其他筛选条件选填
      - (报表实现)不限条件的库位与物料查询,即所有库位与物料情况的查询
- 明细
  - 排序
    - 默认排序: 按照编码升序
    - 字段范围: 编码,类型,状态,是否满装,订单号
  - 筛选
    - 默认筛选: 无
    - 字段范围: 编码,类型,订单号
      - (暂不支持)状态,是否满装
    - 支持扫码查询
- 明细-实体明细
  - 排序
    - 默认排序: 按照批次序号升序
    - 字段范围: 批次序号,容器条码,类型,容器状态,是否满装
  - 筛选
    - 默认筛选: 无
    - 字段范围: 批次序号,容器条码,类型,容器状态,是否满装
    - 支持扫码查询

##### 8.1.4.2 概览

- 显示概览界面
- 按条件对物料进行库存数量汇总
- 刷新: 按条件汇总数据
  - [标准字段值]: 物料编码,物料名称,重量,单位这 4 个字段的数据值在所有查询结果中都必须显示.
  - 不指定任何查询条件时,按照物料编码汇总所库存信息,只显示[标准字段值]
  - 指定查询条件时按照物料编码+查询条件进行显示,汇总分组的顺序为:物料编码,厂区,区域,区段,批次号
    - 厂区,区域,区段是关联的
    - 查询条件中,指定批次号后,获取该批次的物料编码与名称,按批次号查询时,额外显示批次状态,供应商批号信息
    - 指定物料编码后,获取该物料编码对应的物料名称,此时批次列表应该只显示该物料编码相关的批次

##### 8.1.4.3 明细

- 显示该批次的实体(托盘/容器)信息

##### 8.1.4.4 明细-实体明细

- 显示所选托盘相关的所有的容器的详细信息

##### 8.1.4.5 刷新

- 获取服务端最新数据

##### 8.1.4.6 (暂不实现)打印

- 将查询结果按格式打印
  - 库存-按批次表示
  - 库存-按容器表示
  - 批次报告
  - 批次报告-按容器描述

### 8.2 库位物料查询

#### 8.2.1 介绍

- 查找指定厂区,区域内的库位与物料信息, 主要关注库位与物料的信息

#### 8.2.2 界面说明

- 主界面: ![pic](/pics/库存_查询_库位物料.png)

#### 8.2.3 字段说明

- 数据查询使用,无 schema.

#### 8.2.4 操作说明

##### 8.2.4.1 排序筛选

- 主界面-库位与物料列表
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,库位编码,库位名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,库区必填,物料编码选填
      - (报表实现)不限条件的库位与物料查询,即所有库位与物料情况的查询
    - 支持扫码查询

##### 8.2.4.2 刷新

- 获取服务端最新数据

### 8.3 库区物料查询

#### 8.3.1 介绍

- 查找指定厂区,区域内的库区与物料信息, 主要关注库区与物料的信息

#### 8.3.2 界面说明

- 主界面: ![pic](/pics/库存_查询_库区物料.png)

#### 8.3.3 字段说明

- 数据查询使用,无 schema.

#### 8.3.4 操作说明

##### 8.3.4.1 排序筛选

- 主界面-库区与物料列表
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,库区编码,库区名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,库区必填,物料编码选填
      - (报表实现)不限条件的库区与物料查询,即所有库区与物料情况的查询
    - 支持扫码查询

##### 8.3.4.2 刷新

- 获取服务端最新数据

### 8.4 库区批次查询

#### 8.4.1 介绍

- 查找指定厂区,区域内的库区与批次信息, 主要关注库区与批次的信息

#### 8.4.2 界面说明

- 主界面: ![pic](/pics/库存_查询_库区批次.png)

#### 8.4.3 字段说明

- 数据查询使用,无 schema.

#### 8.4.4 操作说明

##### 8.4.4.1 排序筛选

- 主界面-库区与批次列表
  - 排序
    - 默认排序: 按照批次号升序
    - 字段范围: 批次号,物料编码,物料名称,库区编码,库区名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,库区必填,批次号选填
      - (报表实现)不限条件的库区与批次查询,即所有库区与批次情况的查询
    - 支持扫码查询

##### 8.4.4.2 刷新

- 获取服务端最新数据

### 8.5 库区托盘查询

#### 8.5.1 介绍

- 查找指定厂区,区域内的库区与托盘信息, 主要关注库区与托盘的信息

#### 8.5.2 界面说明

- 主界面: ![pic](/pics/库存_查询_库区托盘.png)

#### 8.5.3 字段说明

- 数据查询使用,无 schema.

#### 8.5.4 操作说明

##### 8.5.4.1 排序筛选

- 主界面-库区与托盘列表
  - 排序
    - 默认排序: 按照托盘编码升序
    - 字段范围: 托盘编码,批次号,接收单号,次序号,托盘类型,库区编码,库区名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,库区必填,批次号选填
      - (报表实现)不限条件的库区与托盘查询,即所有库区与托盘情况的查询
    - 支持扫码查询

##### 8.5.4.2 刷新

- 获取服务端最新数据

### 8.6 区段物料查询

#### 8.6.1 介绍

- 查找指定厂区,区域内的区段与物料信息, 主要关注区段与物料的信息

#### 8.6.2 界面说明

- 主界面: ![pic](/pics/库存_查询_区段物料.png)

#### 8.6.3 字段说明

- 数据查询使用,无 schema.

#### 8.6.4 操作说明

##### 8.6.4.1 排序筛选

- 主界面-区段与物料列表
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,区段编码,区段名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,区段必填,物料编码选填
      - (报表实现)不限条件的区段与物料查询,即所有区段与物料情况的查询
    - 支持扫码查询

##### 8.6.4.2 刷新

- 获取服务端最新数据

### 8.7 区段批次查询

#### 8.7.1 介绍

- 查找指定厂区,区域内的区段与批次信息, 主要关注区段与批次的信息

#### 8.7.2 界面说明

- 主界面: ![pic](/pics/库存_查询_区段批次.png)

#### 8.7.3 字段说明

- 数据查询使用,无 schema.

#### 8.7.4 操作说明

##### 8.7.4.1 排序筛选

- 主界面-区段与批次列表
  - 排序
    - 默认排序: 按照批次号升序
    - 字段范围: 批次号,物料编码,物料名称,区段编码,区段名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,区段必填,批次号选填
      - (报表实现)不限条件的区段与批次查询,即所有区段与批次情况的查询
    - 支持扫码查询

##### 8.7.4.2 刷新

- 获取服务端最新数据

### 8.8 区段托盘查询

#### 8.8.1 介绍

- 查找指定厂区,区域内的区段与托盘信息, 主要关注区段与托盘的信息

#### 8.8.2 界面说明

- 主界面: ![pic](/pics/库存_查询_区段托盘.png)

#### 8.8.3 字段说明

- 数据查询使用,无 schema.

#### 8.8.4 操作说明

##### 8.8.4.1 排序筛选

- 主界面-区段与托盘列表
  - 排序
    - 默认排序: 按照托盘编码升序
    - 字段范围: 托盘编码,批次号,接收单号,次序号,托盘类型,区段编码,区段名称,区域编码,厂区编码
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 厂区,区域,区段必填,批次号选填
      - (报表实现)不限条件的区段与托盘查询,即所有区段与托盘情况的查询
    - 支持扫码查询

##### 8.8.4.2 刷新

- 获取服务端最新数据

---

## 9. 库位移动

### 9.1 介绍

- 托盘/容器逐个移动到同一库位

### 9.1 界面说明

- 主界面:![pic](/pics/库存_库位移动.png)

### 9.1 字段说明

- 目标库位:要移动到的目标库位
- 托盘/容器 ID:要移动的托盘/容器条码

### 9.1 操作说明

#### 9.1.1 移动

- 指定目标库位
  - 可用目标库位范围:系统中所有库位,但是库位类型需要与实体类型匹配,如托盘无法转移到存储容器类型的位置，反之亦然，但托盘和容器均可转移到不限容量的存储位置.
  - 当输入待取样的实体时，系统检查该库位是否属于该物料采样库区,不满足的话,则拒绝移动该实体
- 录入托盘/容器条码,条码必须是已存在的.
- 待取样的容器位于常规托盘上时,不允许移动,提示"容器将要取样，无法转移!"; 只能移动该托盘
- 目标位置和初始位置不能相同，否则拒绝移动
- 校验目标库位的特性是否与所存物料兼容,如不兼容,需提示用户是否执行该操作.
- 校验目标库位的库区是否与物料上设定的默认/备用库区是否兼容,如不兼容,需提示用户是否执行该操作.
- 若目的地位置没有足够的空间接收物料,如空间不足,需提示用户是否执行该操作
- 明细信息
  - 显示当前录入的托盘(链接到[库存管理-托盘管理-明细])/容器明细(链接到[库存管理-容器管理-明细])

---

## 10. 确认接收(暂不实现)

### 10.1 配置工作中心配给库位

- 为工作中心指定专用配给库位,供工单的物料分配使用
- 工作中心的配给库位,必须是不限容量的库位

### 10.2 确认接收

#### 10.2.1 介绍

- 将物料从原始库存位置转移到`当前工作中心`的配给库位,在该工作中心执行的工单的物料分配,使用该库位的信息
  - 工单物料的分配,不扣减库存,是工单的配给计划
- 记录的是实际领到当前工作中心的物料信息

#### 10.2.2 界面说明

- 主界面:![pic](/pics/库存_XX.png)
- 显示当前工作中心的信息:厂区,区域,区段,位置,工作中心编码,工作中心名称,工作中心配给库位编码和名称
- 输入框接收容器/托盘的 ID
- 显示本次已接收的实体清单,字段如下
  - 实体 ID,物料编码,物料名称,批次号,接收数量,单位

#### 10.2.3 操作说明

- 移动:将物料从原始库存位置转移到`当前工作中心`的配给库位
- 移动方式:托盘/容器(使用实体 ID)
- 移动限制:
  - 工作中心的配给库位必须是不限容量的
  - 必须是系统中已存在的实体
  - 能是已经在当前配给库位的实体
  - 必须是无需取样或已取样的实体
  - 工作中心的配给库位不能是配送类型(见 EmplacementType)
  - 不检测是否与配给库位的冷藏,安全,是否可分配,高度,列表等是否匹配

---

## 11. 物料需求

### 11.1 介绍

- 各种物料的供应需求由系统汇总计算,以列表形式展示
  - 统计缺料情况,不缺料的不需要显示

### 11.2 界面说明

- 主界面-工单需求:![pic](/pics/库存_物料需求_工单需求.png)
- 主界面-最小库存:![pic](/pics/库存_物料需求_最小库存.png)

### 11.3 字段说明

- 预测日期: 时间格式 YYYY-MM-DD,类型为工单需求时,预测日期必填;类型为最小库存时,预测日期为空,不可编辑.
- 预测类型: 工单需求/最小库存,单选必填.
  - 工单需求:不考虑最小库存,考虑符合条件的工单执行所需物料情况,默认选择该项.
  - 最小库存:不考虑工单所需物料情况,考虑最小库存的需求.
- 物料编码:结合工单,工单物料与物料表,获取物料表中的物料编码,限制条件为工单发布时间<=预测日期,且不是新创建的工单.
- 物料名称:通过物料编码获取,
- 最小库存:物料的安全库存,通过物料编码获取,按最小库存预测时才显示该字段,字段长度:float(10,3).
- 单位:物料的库存单位,通过物料编码获取.
- 库存:当前库存,按指定汇总条件,汇总库存信息,不含驳回和挂起的批次,不含预收数量,字段长度:float(10,3).
- 预收数量:按指定汇总条件,汇总批次接收信息,只同期批次接收状态为未处理的批次,字段长度:float(10,3).
- 工单总需求量:按指定汇总条件,汇总工单物料的需求信息,工单发布时间<=预测日期,不含可编辑/已删除/已关闭的工单,按工单需求预测时才显示该字段,字段长度:float(10,3).
  - 汇总时统一转换为物料的库存单位.
- 待供应量:按照指定条件,由系统计算,字段长度:float(10,3).

### 11.4 操作说明

#### 11.4.1 排序筛选

- 主界面-工单需求
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,物料类型,工单总需求量,库存量,预收数量,待供应量,单位
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 物料编码必填
      - (报表实现)不限条件查询,即所有物料缺料情况的查询
    - 支持扫码查询
- 主界面-最小库存
  - 排序
    - 默认排序: 按照物料编码升序
    - 字段范围: 物料编码,物料名称,物料类型,最小库存,库存量,预收数量,待供应量,单位
  - 筛选
    - 默认筛选: 无
    - 按照界面筛选条件筛选: 物料编码必填
      - (报表实现)不限条件查询,即所有物料缺料情况的查询
    - 支持扫码查询
- 预测日期: 用户指定预测截止日期,默认值为当前日期+1 个月, 仅按工单需求预测时需要输入该信息

#### 11.4.2 刷新

- 按照所选预测类型,计算并刷新业务数据
  - 工单需求:公式: 待供应量 = 工单总需求量 - (库存量 + 预收数量)
    - 工单总需求量:所有已发布工单的物料需求量
    - 库存量:当前库存量,已接收入库的批次的库存数量,不含被驳回,锁定,失效的批次
      - 驳回,锁定,失效的批次正常情况是不在生产中使用的.
    - 预收数量:该物料已计划接收的数量(批次接收的接收计划已创建)
  - 最小库存:公式: 待供应量 = 最小库存 - (库存量 + 预收数量)
    - 最小库存:物料上设定的最小库存值
    - 库存量:当前库存量,已接收入库的批次的库存数量,不含被驳回,锁定,失效的批次
      - 驳回,锁定,失效的批次正常情况是不在生产中使用的.
    - 预收数量:该物料已计划接收的数量(批次接收的接收计划已创建)

#### 11.4.3 物料需求明细(暂不实现)

- 预测类型为工单需求时,按工单显示指定物料的需求明细,按照优先级(工单优先级需添加)累计扣减(库存量 + 预收数量)

#### 11.4.4 打印

- 将查询结果按指定格式打印

---

## 12. 结束容器管理

### 12.1 介绍

- 主要功能有维护容器的结束状态,剩余量归零,删除等操作

### 12.2 界面说明

- 主界面: ![pic](/pics/库存_结束容器管理.png)

### 12.3 字段说明

- 厂区:容器所属库区的厂区
- 区域:容器所属库区的区域
- 区段:容器所属库区的区段
- 库区:容器所属库位的库区
- 库位:容器所属库位
- 容器 ID:容器的条码 ID
- 结束容器:是否是已结束容器
- 容器类型:哪种标准容器
- 托盘编号:容器所属托盘编号
- 批次号:容器中物料所属批次
- 物料编码:容器中的物料编码
- 物料名称:通过物料编码获取
- 容器状态:容器的状态,除单独指定外同批次状态
- 剩余数量:容器中物料的剩余数量
- 单位:库存单位,通过物料编码获取

### 12.4 操作说明

#### 12.4.1 排序筛选

- 主界面
  - 排序
    - 默认排序: 按照容器 ID 升序
    - 字段范围: 容器 ID,结束容器,物料编码,物料名称,容器状态
      - (暂不实现)厂区,区域,区段,库区,库位,批次号
  - 筛选
    - 默认筛选: 已结束容器
    - 字段范围: 容器 ID,批次号,物料编码,物料名称,剩余数量,厂区,区域,区段,库区,库位
      - (暂不实现)结束容器,容器状态
    - 支持扫码查询

#### 12.4.2 结束容器

- 将容器设置为已结束

#### 12.4.3 取消结束

- 将容器设置为取消结束

#### 12.4.4 归零

- 将该容器的剩余量归零,归零后容器自动结束.属于库存调整事务
- 归零后,该容器所属托盘的"是否满装"设置为 false
- 调整与该容器相关的库存(Inv)信息,需要按照归零前的容器中的库存量扣减/删除库存

#### 12.4.5 删除

- 删除该容器,属于库存调整事务
- 执行归零业务,作为删除操作的一部分业务
  - 将该容器的库存量归零,归零后容器自动结束.属于库存调整事务
  - 归零后,由于容器所属托盘的"是否满装"设置为 false
  - 该容器的库位的库存数,需要按照归零前的容器中的库存量扣减
- 解除/删除容器与托盘的关联
  - 如果托盘下只有该容器,则直接删除托盘
- 按照删除的容器量,增加该库位的剩余容量

#### 12.4.5 重打标

- 重新打印筛选出的容器的标签

#### 12.4.6 刷新

- 获取服务端最新数据

---

## 13. 退料

### 13.1 介绍

- 工单物料称量后,如果工单取消,那么已称物料需要退料返库
  - 未称量物料,没有执行出库扣减,直接拉回原库位,或使用相应的移动功能移动到新库位即可
  - 已称量物料,使用退料功能
- 退料,只适用无批次混合的称量

### 13.2 界面说明

- 主界面:![pic](/pics/库存_退料.png)

### 13.3 字段说明

- 是否已删除工单:勾选该项时,只能使用已删除工单的称量标签进行退料
- 称量标签 ID:称量时,所出标签
- 批次号:物料所属批次号
- 物料编码:容器所存物料
- 物料名称:通过物料编码获取
- 退料数量:称量签所代表的重量
- 单位:库存单位,称量所用单位要转换为库存单位
- 厂区:容器所处工作中心的厂区
- 区域:容器所处工作中心的区域
- 区段:容器所处工作中心的区段
- 当前位置: 容器所处工作中心的位置
- 工作中心:容器所处工作中心
- 存储方式:
  - 存储在新容器中:
    - 容器序号:新容器的序号,物料所属批次的容器序号+1
    - 容器类型:新容器的类型(标准容器)
    - 容器类型名称:通过容器类型编码获取
    - 皮重:新容器的皮重
    - 皮重单位:新容器的皮重单位,默认为所选标准容器的皮重单位
    - 目标库位:选择目标库位(通过库区下的库位选择)
  - 存储在已有容器:
    - 可用筛选条件(复选),默认全部勾选
      - 在当前位置的库区:与当前位置相同的库区下的库位
      - 在剩余量足够的库位:库区中所有剩余量足够的库位
      - 复选的条件之间为 AND 关系
    - 已有容器的物料必须和当前物料是同一批次的

### 13.4 操作说明

#### 13.4.1 排序筛选

- 主界面-已有容器列表
  - 排序
    - 默认排序: 按照容器 ID 升序
    - 字段范围: 容器 ID,库位
  - 筛选
    - 按照当前位置和剩余容量足够两个条件筛选,多选条件,
    - 使用复选框的方式实现.勾选后自动刷新数据

#### 13.4.2 退料

- 退料操作步骤
  - S0:选择是否已删除工单,默认勾选
  - S1:使用称量标签,进行退料,录入标签条码后,点击加载,显示以下只读信息
    - 批次号
    - 物料编码
    - 物料名称
    - 退料数量及单位
    - 厂区
    - 区域
    - 区段
    - 当前位置
    - 工作中心
  - S2:选择存储类型
    - S2.1 存储在新容器中, 系统会依据批次自动创建托盘和容器(容器的标准容量与容器当前库存相同)
      - 容器序号,自动生成
      - 选择容器类型
      - 填写皮重并选择皮重单位
      - 选择目标库位
    - S2.1 存储在已有容器
      - 勾选已删除工单时,不能使用该类型.
      - 使用复选框进行目标容器筛选:
      - 在筛选结果中,指定目标容器
- 退料的限制条件:
  - 使用系统已有称量标签进行退料,
  - 勾选已删除工单时,工单状态为已删除时,该工单的工单物料才可进行退料
  - 已退料的不能再次退料
    - 称量记录中该次(通过称量标签确定)称量的集中状态为取消称量(已退料)
  - 工单物料的集中状态不为已集中时,才可进行退料
- 退料校验
  - 校验目标库位的特性是否与所存物料兼容,如不兼容,需提示用户是否执行该操作.
  - 校验目标库位的库区是否与物料上设定的默认/备用库区是否兼容,如不兼容,需提示用户是否执行该操作.
- 退料结果
  - 使用新容器时
    - 退料完成后,批次的容器数量+1
    - 新增对应托盘,托盘信息: 托盘编号(使用容器编号),物料编码.批次号,托盘类型,托盘状态(已入库),是否满装(TRUE),最后操作日期,库位,托盘初始库位的编码,目标托盘库位编码,退料数量,单位,托盘序号(1),托盘数(1)
    - 新增对应容器,容器信息:物料编码,批次号,容器总数,容器序号,容器类型,容器状态,容器 ID,托盘编号(使用容器编号),容器标准容量(退料数量),容器的当前库存(退料数量),皮重,皮重单位,容器取样状态(使用批次取样状态),容器取样数(0),打开状态(FALSE)
    - 调整批次容器数量
    - 系统会自动打印出新容器的条码
    - 调整库存(Inv): 增加对应批次物料的库位库存:物料编码,批次号,库位,库存量等信息
    - 通过称量标签,修改工单物料的称量记录中该物料的该次称量的集中状态为取消称量(已退料)
    - 取消谱系关联:没有勾选已删除工单时,按批次和工单删除耗料的谱系信息
  - 使用已有容器时
    - 按退料信息,调整所用容器的相关信息
    - 调整库存(Inv): 增加对应批次物料的库位库存:物料编码,批次号,库位,库存量等信息
    - 通过称量标签,修改工单物料的称量记录中该物料的该次称量的集中状态为取消称量(已退料)
- 退回一个空容器时,如果系统识别所用 ID 不是一个空容器时,可以进行以下列表中的一项调整:
  - 使用结束批次功能
  - 进行库存调整,调整容器库存,将容器存储到库位
  - 使用结束容器管理,进行容器调整(考虑删除容器).
- 退回一个非空容器时,如果系统识别所用 ID 是一个空容器时,可以进行以下列表中的一项调整:
  - 使用结束容器管理,进行容器调整.
- 退料不维护托盘中相关的接收信息(接收之后的库存调整类业务,与接收单无直接关系):事务类型,接收订单号,接收序号
  -(暂不实现)后续方案：
  - 系统内置特殊接收单: 事务类型(--),物料接收的单号(------),物料接收的序号(----)
  - 退料业务:使用固定值填充字段:事务类型(--),物料接收的单号(------),物料接收的序号(----)

---

## 14. 库存调整

### 14.1 库存调整

#### 14.1.1 介绍

- 在定义的工单之外,使用物料时,系统提供库存的移动事务支持.如损失,入库后的库存调整等
- 库存调整的对象是容器

#### 14.1.2 界面说明

- 主界面: ![pic](/pics/库存_库存调整.png)

#### 14.1.3 字段说明

- 容器 ID:容器的条码 ID,必填项
- 批次号:物料的批次号,通过容器 ID 获取,不可编辑
- 容器序号:本批次中,该容器的序号.
- 容器状态:通过容器 ID 获取,不可编辑
- 物料编码:通过容器 ID 获取,不可编辑
- 物料名称:通过容器 ID 及物料编码获取,不可编辑
- 厂区:容器的初始厂区,通过库位的库区获取,不可编辑
- 区域:容器的初始区域,通过库位的库区获取,不可编辑
- 区段:容器的初始区段,通过库位的库区获取,不可编辑
- 库区:容器的初始库区,通过库位获取,不可编辑
- 库位:容器的初始库位,容器所属库位,不可编辑
- 剩余量:该容器中的物料剩余量,不可编辑,字段长度 float(10,6)
- 调整数量:要调整的数量,字段长度 float(10,6)
  - 用户输入:除删除之外的调整,需要用户输入调整数量
  - 系统填写:容器删除的库存调整,系统自动输入容器的剩余量
- 调整单位:库存单位 2
- 容器类型:通过容器 ID 获取
  - 可编辑:重新激活容器的调整事务,可编辑该项,从系统已有标准容器类型中选择.
  - 不可编辑:除重新激活容器的调整事务外,不可编辑
- 容器类型名称:通过容器类型获取,不可编辑
- 容器皮重:通过容器类型获取,不可编辑
- 容器皮重单位:通过容器类型获取,不可编辑
- 结束容器:默认为 FALSE,可编辑,与输入数量无关
- 调整的事务编码:通过功能编码获取,不可编辑
- 调整的事务名称:通过事务编码获取,不可编辑
- 调整的功能编码:选取系统中已定义功能
- 调整的功能名称:通过功能编码获取,不可编辑

#### 14.1.4 操作说明

##### 14.1.4.1 库存调整

- 容器条码录入:系统进行以下校验
  - 是否为系统已存在的容器条码,若无法识别,则提示"未知容器!"
  - (暂不实现,参考章节:重新激活容器)如果是 EBR 系统曾经接收过的容器(通过查询容器创建的历史记录判定),但是已被删除,且其批次状态不是已失效状态,则提示"容器已失效,是否再次启用?",确认启用后
    - 如果没有相同批次的容器，则使用 C1 的属性初始化容器类型,以及对应于的皮重和皮重单位
    - 如果有相同批次的容器，则使用该批次第一个(按该批次容器的顺序号排列)容器的类型来初始化容器类型,以及对应于的皮重和皮重单位
  - 如果识别为已结束容器,则需提示用户"该容器已结束,是否继续?"
- 识别合法条码后,加载容器的相关信息
- 选择调整的功能,加载功能对应的事务编码和名称
- 数量调整:按照输入的调整数量,调整指定容器的库存量
  - 调整数量>0:容器的库存量,即剩余量增加
  - 调整数量 0:不支持调整数量为 0,提示用户重新输入
  - 调整数量<0:容器的库存量,即剩余量减少,但输入的数量加上剩余量必须大于等于 0,否则提示"此值表示调整后的库存为负数,请重新输入"
- 结束容器
  - 按照用户指定的状态,更新调整后的容器的结束容器状态,调整后,如果剩余量<=0 时,如果用户没有设定结束容器为 TRUE,提示用户确认该操作"调整之后的剩余量小于等于 0,请确认该容器是否为不结束状态"
  - 当库存调整发生在一个被认为是已结束的容器上,其剩余数量从<=0 变为正数时，系统自动将该容器视为未结束.
- 调整容器是否满装
- 调整容器所属托盘的满装属性
- 按照容器库存量的变动,调整库存(Inv)信息库位的库存剩余量

##### 14.1.4.2 重新激活容器(暂不实现)

- 按照设定重新创建容器

### 14.2 库存调整追溯

#### 14.2.1 介绍

- 库存调整业务的历史追溯信息

#### 14.2.2 界面说明

- 主界面: ![pic](/pics/.png)

#### 14.2.3 字段说明

- 业务字段
  - 批号
  - 容器编号
  - 容器状态
  - 物料编码
  - 物料名称
  - 厂区
  - 区域
  - 区段
  - 库区
  - 库位
  - 调整数量
  - 调整单位
  - 调整时间
  - 容器类型
  - 容器类型名称
  - 容器皮重
  - 容器皮重单位
  - 事务编码
  - 功能编码

#### 14.2.4 操作说明

#### 14.2.4.1 排序筛选

- 主界面-位置列表
  - 排序
    - 默认排序:按照批号升序
    - 字段范围:批号,物料编码,事务编码,功能编码,调整时间
  - 筛选
    - 默认筛选:无
    - 字段范围:批号,容器编号,调整时间

#### 14.2.4.2 刷新

- 查询,获取服务端最新数据

#### 14.2.4.3 打印

- 将查询结果按指定格式打印

---

## 15. 结束批次

### 15.1 介绍

- 将空批次/符合结束条件的批次结束(失效).

### 15.2 界面说明

- 主界面: ![pic](/pics/库存_结束批次.png)

### 15.3 字段说明

- 物料编码:来自物料表
- 物料名称:通过物料编码获取
- 物料类型:通过物料编码获取
- 批次号:来自批次表
- 批次状态:通过批次号获取
- 物料触发值:物料上的结束批次触发值,通过物料编码获取
- 触发量:使用筛选条件上的触发值算出的触发量,使用库存单位.
- 总量:来自库存(Inv)表,按照批次号+料号汇总
- 单位:库存单位,通过物料编码获取

### 15.4 操作说明

#### 15.4.1 排序筛选

- 主界面-所有容器已结束的批次/筛选结果
  - 排序:按照批号升序
  - 筛选:按照界面筛选条件进行筛选.

#### 15.4.2 结束批次

- 批次结束操作,一个批次一个批次进行,不支持多选.
- 指定要结束的批次
  - 已经失效的批次,不允许再次结束批次
  - 从批次所有容器已结束的批次列表中选择,即批次下所有容器全部是结束容器时,该批次在此列表中出现
  - 按条件筛选需要结束的批次,可用筛选条件如下,三个条件为单选互斥,在筛选的结果列表中选择
    - 使用物料上设定的结束批次触发值(T1)来筛选
      - 计算公式:批次剩余数量(C)<=(批次接收量(R)xT1)
    - 使用指定的结束批次触发值(T2)来筛选,此时指定值替代物料设定值
      - 计算公式:批次剩余数量(C)<=(批次接收量(R)xT2)
    - 使用批次的最小当前库存量(M),来筛选
      - 查找小于当前所设定的库存量的批次
      - 计算公式:批次剩余数量(C)<=M
- 结束批次
  - 超出批次剩余数量(C)>(批次接收量(R)xT1)时,要提示用户是否继续执行该操作
  - 可结束批次的验证逻辑图如下
    - ![pic](/pics/库存_结束批次验证.png)
    - 注:目前只处理蓝色框内部分
    - 指定批次的物料已被工单(非已关闭/非已删除状态)物料称量使用的不允许结束批次,否则均允许结束批次.
    - (暂不处理)预配部分
  - 批次结束后,更新批次接收的取消/删除时间为当前系统时间
  - 批次结束后,更新批次的状态为已失效状态,可供后期归档
  - 批次结束后,更新批次的决定时间为当前系统时间
  - 批次结束后,按批次号和物料号删除相关的库存(Inv),托盘,容器信息.
  - 批次结束后,释放相关(限制容量的)库位的剩余容量和预配量.
- 结束批次需要配置签名

---

## 16. 仓库月度统计(暂不实现)

### 16.1 介绍

- 按月份来统计仓库的活动数据,原材料及包材的接收与配送称量的汇总数据

### 16.2 界面说明

- 主界面: ![pic](/pics/库存_月度统计.png)

### 16.3 字段说明

### 16.4 操作说明

## 17. 中间站与暂存罐

- 中间站/暂存罐:可使用 EBR 库存管理
  - 要求:中间站/暂存罐,需处于两个工单之间,
  - 入中间站/暂存罐:使用后工单的终产品声明后的批次物料接收
  - 出中间站/暂存罐:使用前工单的称量投料
  - 暂存罐混批:有多个批次/工单打入暂存罐,
    - 入:各批次单独进行入库,属于后工单的终产品.
    - 出:混合后供前工单使用,属于前工单的原料;单独称量出库,使用混料功能,将多批次原料混合.

## 18. 库位库区可视化显示

### 18.1 库位可视化

#### 18.1.1 介绍

- 显示指定库位的使用情况：以该库位的单位为单元格，绘制总容量，并用颜色标记已占用的、预配的、剩余的。

#### 18.1.2 界面说明

- 有限容量的库位: ![pic](/pics/库存可视化_有限容量库位.png)
  - 每个单位一个单元格,共有 MAX("总容量",实体数量)个单元格
    - 实际存储量可能会超过总容量,即存在溢出的情况.溢出时,用加黑加粗的框标识出总容量
  - 每行最多 10 个单元格
  - 蓝色表示已占用,柠檬色表示预配的,空白表示剩余的
  - 单元格个数,按数量向上取整
- 不限容量的库位: ![pic](/pics/库存可视化_不限容量库位.png)
  - 一个空白单元格(大小约为 10\*3 个有限容量的单元格)

#### 18.1.3 字段说明

- 无

#### 18.1.4 操作说明

- 库位主界面添加[图示]按钮（UI 原型已更新）
- 选择库位，点击[图示],显示库位的可视化图形表示
- 点击库位图示界面上,库区后面的[查询],显示对应库区的可视化图形表示

### 18.2 库区可视化

#### 18.2.1 介绍

#### 18.2.2 界面说明

- 库区: ![pic](/pics/库存可视化_库区.png)
  - 按比例显示库区下各个库位的使用情况
    - 蓝色表示已占用,柠檬色表示预配的,空白表示剩余的
    - 溢出时,用加黑加粗的框标识出总容量
    - 不限容量的库位,使用一个空白单元格表示

#### 18.2.3 字段说明

- 无

#### 18.2.4 操作说明

- 库区主界面添加[图示]按钮（UI 原型已更新）
- 选择库区，点击[图示],显示库区的可视化图形表示
- 双击库区下的库位的图示,显示所选库位的可视化图形表示
  - 通过库区列表中的库位,查看库位的可视化显示时,不显示[查看]按钮(UI上库区之后的查看按钮),